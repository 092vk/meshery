{
  "apiVersion": "core.meshery.io/v1alpha1",
  "kind": "Hierarchical",
  "metadata": {
    "description": "A hierarchical inventory relationship in which the configuration of (parent) component is patched with the configuration of other (child) component. Eg: The configuration of the EnvoyFilter (parent) component is patched with the configuration as received from WASMFilter (child) component."
  },
  "model": {
    "name": "kubernetes",
    "version": "v1.25.2",
    "displayName": "Kubernetes",
    "category": {
      "name": "Orchestration \u0026 Management",
      "metadata": null
    },
    "metadata": {}
  },
  "subType": "Inventory",
  "evaluationQuery": "heirarchical_inventory_relationship",
  "selectors": [
    {
      "allow": {
        "from": [
          {
            "kind": "WASMFilter",
            "model": "istio-base",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                [
                  "settings",
                  "config"
                ],
                [
                  "settings",
                  "wasm-filter"
                ]
              ],
              "description": "WASM filter configuration to be applied to Envoy Filter."
            }
          }
        ],
        "to": [
          {
            "kind": "EnvoyFilter",
            "model": "istio-base",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "configPatches",
                  "_",
                  "patch",
                  "value"
                ]
              ],
              "description": "Receive the WASM filter configuration."
            }
          },
          {
            "kind": "WasmPlugin",
            "model": "istio-base",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "pluginConfig"
                ],
                [
                  "settings",
                  "spec",
                  "url"
                ]
              ],
              "description": "Receive the WASM filter configuration."
            }
          }
        ]
      },
      "deny": {
        "from": [],
        "to": []
      }
    },
    {
      "allow": {
        "from": [
          {
            "kind": "ConfigMap",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                [
                  "name"
                ]
              ],
              "description": "In Kubernetes, ConfigMaps are a versatile resource that can be referenced by various other resources to provide configuration data to applications or other Kubnernetes resources.\n\nBy referencing ConfigMaps in these various contexts, you can centralize and manage configuration data more efficiently, allowing for easier updates, versioning, and maintenance of configurations in a Kubernetes environment."
            }
          }
        ],
        "to": [
          {
            "kind": "Deployment",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "spec",
                  "template",
                  "spec",
                  "containers",
                  "_",
                  "envFrom",
                  "0",
                  "configMapRef",
                  "name"
                ]
              ],
              "description": "Deployments can reference ConfigMaps to inject configuration data into the Pods they manage. This is useful for maintaining consistent configuration across replica sets.\n\nThe keys from the ConfigMap will be exposed as environment variables to the containers within the pods managed by the Deployment."
            }
          },
          {
            "kind": "StatefulSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "spec",
                  "template",
                  "spec",
                  "containers",
                  "_",
                  "envFrom",
                  "0",
                  "configMapRef",
                  "name"
                ]
              ],
              "description": "StatefulSets can use ConfigMaps to provide configuration data to their pods in a similar way to Deployments.\n\nConfigMaps can be referenced in the Pod template specification of a StatefulSet to provide configuration data to each pod in a consistent manner."
            }
          },
          {
            "kind": "DaemonSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "spec",
                  "template",
                  "spec",
                  "containers",
                  "_",
                  "envFrom",
                  "0",
                  "configMapRef",
                  "name"
                ]
              ],
              "description": "DaemonSets, which ensure that a copy of a pod runs on each node, can utilize ConfigMaps to supply configuration data to their pods.\n\nThe keys from the ConfigMap will be exposed as environment variables to the containers within the pods managed by the DaemonSet."
            }
          },
          {
            "kind": "ReplicaSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "spec",
                  "template",
                  "spec",
                  "containers",
                  "_",
                  "envFrom",
                  "0",
                  "configMapRef",
                  "name"
                ]
              ],
              "description": "When deploying applications using ReplicaSets, you may need to configure each replica with specific settings, such as environment variables or configuration files. ConfigMaps can be referenced in the Pod template specification of a ReplicaSet to provide configuration data to each replica pod.DaemonSets, which ensure that a copy of a pod runs on each node, can utilize ConfigMaps to supply configuration data to their pods.\n\nThe keys from the ConfigMap will be exposed as environment variables to the containers within the pods managed by the ReplicaSet."
            }
          },
          {
            "kind": "Pod",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "spec",
                  "containers",
                  "_",
                  "envFrom",
                  "0",
                  "configMapRef",
                  "name"
                ]
              ],
              "description": "ConfigMaps can be referenced in the Pod specification to inject configuration data into the Pod's environment.\n\nThe keys from the ConfigMap will be exposed as environment variables to the container within the Pod."
            }
          },
          {
            "kind": "Job",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "spec",
                  "template",
                  "spec",
                  "containers",
                  "_",
                  "envFrom",
                  "0",
                  "configMapRef",
                  "name"
                ]
              ],
              "description": "ConfigMaps can be referenced in the Pod template specification within the Job definition to inject configuration data into the pods.\n\nThe keys from the ConfigMap will be exposed as environment variables to the container within the pod created by the Job."
            }
          },
          {
            "kind": "CronJob",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                [
                  "settings",
                  "spec",
                  "jobTemplate",
                  "spec",
                  "template",
                  "spec",
                  "containers",
                  "_",
                  "envFrom",
                  "0",
                  "configMapRef",
                  "name"
                ]
              ],
              "description": "ConfigMaps can be referenced in the Pod template specification within the CronJob definition to inject configuration data into the pods.\n\nThe keys from the ConfigMap will be exposed as environment variables to the container within the pod created by the CronJob."
            }
          }
        ]
      },
      "deny": {
        "from": [],
        "to": []
      }
    },
    {
      "allow": {
        "from": [
          {
            "kind": "Pod",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["name"],
                ["namespace"],
                ["kind"],
                ["apiVersion"]
              ],
              "description": "A Pod "
            }
          },
          {
            "kind": "Deployment",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["name"],
                ["namespace"],
                ["kind"],
                ["apiVersion"]
              ],
              "description": "A Deployment "
            }
          },
          {
            "kind": "StatefulSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["name"],
                ["namespace"],
                ["kind"],
                ["apiVersion"]
              ],
              "description": "A StatefulSet "
            }
          },
          {
            "kind": "ReplicaSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["name"],
                ["namespace"],
                ["kind"],
                ["apiVersion"]
              ],
              "description": "A ReplicaSet "
            }
          },
          {
            "kind": "Service",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["name"],
                ["namespace"],
                ["kind"],
                ["apiVersion"]
              ],
              "description": "A Service "
            }
          },
          {
            "kind": "ConfigMap",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["name"],
                ["namespace"],
                ["kind"],
                ["apiVersion"]
              ],
              "description": "A ConfigMap "
            }
          },
          {
            "kind": "Secret",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["name"],
                ["namespace"],
                ["kind"],
                ["apiVersion"]
              ],
              "description": "A Secret "
            }
          }
        ], 
        "to": [
          {
            "kind": "Event",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                ["settings", "regarding", "name"],
                ["settings", "regarding", "namespace"],
                ["settings", "regarding", "kind"],
                ["settings", "regarding", "apiVersion"]
              ],
              "description": "An Event "
            }
          }
        ]
      }
    },
    {
      "allow": {
        "from": [
            {
                "kind": "Secret",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatorRef": [
                        [
                            "name"
                        ]
                    ],
                    "description": "In Kubernetes, Secrets are versatile resources that can be referenced by various other resources to provide configuration data to applications or other Kubernetes resources securely.\n\nBy referencing Secrets in these various contexts, you can centralize and manage configuration data more efficiently, allowing for easier updates, versioning, and maintenance of configurations in a Kubernetes environment."
                }
            }
        ],
        "to": [
            {
                "kind": "Deployment",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatedRef": [
                        [
                            "settings",
                            "spec",
                            "template",
                            "spec",
                            "containers",
                            "_",
                            "envFrom",
                            "0",
                            "secretRef",
                            "name"
                        ]
                    ],
                    "description": "Deployments can reference Secrets to inject confidential configuration data into the Pods they manage. This is useful for maintaining consistent configuration across replica sets.\n\nThe keys from the Secret will be exposed as environment variables to the containers within the pods managed by the Deployment."
                }
            },
            {
                "kind": "StatefulSet",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatedRef": [
                        [
                            "settings",
                            "spec",
                            "template",
                            "spec",
                            "containers",
                            "_",
                            "envFrom",
                            "0",
                            "secretRef",
                            "name"
                        ]
                    ],
                    "description": "StatefulSets can use Secrets to provide confidential configuration data to their pods in a similar way to Deployments.\n\nSecrets can be referenced in the Pod template specification of a StatefulSet to provide configuration data to each pod in a consistent manner."
                }
              },
            {
                "kind": "DaemonSet",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatedRef": [
                        [
                            "settings",
                            "spec",
                            "template",
                            "spec",
                            "containers",
                            "_",
                            "envFrom",
                            "0",
                            "secretRef",
                            "name"
                        ]
                    ],
                    "description": "DaemonSets, which ensure that a copy of a pod runs on each node, can utilize Secret to supply confidential configuration data to their pods.\n\nThe keys from the Secret will be exposed as environment variables to the containers within the pods managed by the DaemonSet."
                }
            },
            {
                "kind": "ReplicaSet",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatedRef": [
                        [
                            "settings",
                            "spec",
                            "template",
                            "spec",
                            "containers",
                            "_",
                            "envFrom",
                            "0",
                            "secretRef",
                            "name"
                        ]
                    ],
                    "description": "When deploying applications using ReplicaSets, you may need to configure each replica with specific settings, such as environment variables or configuration files. Secrets can be referenced in the Pod template specification of a ReplicaSet to provide configuration data to each replica pod."
                }
            },
            {
                "kind": "Pod",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatedRef": [
                        [
                            "settings",
                            "spec",
                            "containers",
                            "_",
                            "envFrom",
                            "0",
                            "secretRef",
                            "name"
                        ]
                    ],
                    "description": "Secret can be referenced in the Pod specification to inject confidential configuration data into the Pod's environment.\n\nThe keys from the Secret will be exposed as environment variables to the container within the Pod."
                }
            },
            {
                "kind": "Job",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatedRef": [
                        [
                            "settings",
                            "spec",
                            "template",
                            "spec",
                            "containers",
                            "_",
                            "envFrom",
                            "0",
                            "secretRef",
                            "name"
                        ]
                    ],
                    "description": "Secret can be referenced in the Pod template specification within the Job definition to inject confidential configuration data into the pods.\n\nThe keys from the Secret will be exposed as environment variables to the container within the pod created by the Job."
                }
            },
            {
                "kind": "CronJob",
                "model": "kubernetes",
                "patch": {
                    "patchStrategy": "replace",
                    "mutatedRef": [
                        [
                            "settings",
                            "spec",
                            "jobTemplate",
                            "spec",
                            "template",
                            "spec",
                            "containers",
                            "_",
                            "envFrom",
                            "0",
                            "secretRef",
                            "name"
                        ]
                    ],
                    "description": "Secret can be referenced in the Pod template specification within the CronJob definition to inject confidential configuration data into the pods.\n\nThe keys from the Secret will be exposed as environment variables to the container within the pod created by the CronJob."
                }
            }
        ]
      },
      "deny": {
        "from": [],
        "to": []
      }
    },
    {
      "allow": {
        "from": [
          {
            "kind": "Deployment",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["settings", "spec", "selector", "matchLabels"]
              ], 
              "description": " Deployments manage ReplicaSets and provide features such as rolling updates and rollback functionality. PDBs can be associated with Deployments to maintain availability during updates and ensure a minimum number of pods are available during the transition."
            }
          },
          {
            "kind": "ReplicaSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["settings", "spec", "selector", "matchLabels"]
              ],
              "description": "ReplicaSets ensure a specified number of pod replicas are running at any given time. PDBs can be applied to ReplicaSets to enforce constraints on how many pods can be disrupted at once during scaling operations or node maintenance."
            }
          }, 
          {
            "kind": "StatefulSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["settings", "spec", "selector", "matchLabels"]
              ],
              "description": "StatefulSets are used for stateful applications that require stable, unique network identifiers and persistent storage. PDBs can be used with StatefulSets to control pod disruptions and ensure data integrity during maintenance or scaling."
            }
          }, 
          {
            "kind": "DaemonSet",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatorRef": [
                ["settings", "spec", "selector", "matchLabels"]
              ],
              "description": "DaemonSets ensure that a copy of a pod runs on each node in the cluster. PDBs can be used to prevent too many pods from being disrupted simultaneously during node maintenance or upgrades, ensuring that essential services provided by DaemonSets remain available."
            }
          }
        ],
        "to": [
          {
            "kind": "PodDisruptionBudget",
            "model": "kubernetes",
            "patch": {
              "patchStrategy": "replace",
              "mutatedRef": [
                ["settings", "spec", "selector", "matchLabels"]
              ]
            },
            "description": "In Kubernetes, Pod Distribution Budgets (PDBs) are used to ensure that a certain number or percentage of pods are running on particular nodes or within particular zones."
          }
        ]
      },
      "deny": {
        "from": [],
        "to": []
      }
    }
  ]
}
