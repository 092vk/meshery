name: Reset running Meshery playground
on:
   workflow_dispatch:
   schedule:
     - cron:  '0 0 * * *'  # Run the job every day at midnight

jobs:
   reset:
     runs-on: ubuntu-latest 
     steps:
      - name: Install kubectl
        run: apt-get update;apt-get install -y kubectl
      - name: Extract kubeconfig
        run: echo "${{ secrets.PLAYGROUND_CONFIG }}" | base64 --decode > ~/.kube/config
      - name: Delete namespaces except the ones which are whitelisted in the if statement
        run: |
         for ns in $(kubectl get ns -o jsonpath="{.items[*].metadata.name}");
         do
         if [[ "$ns" != "kube-system" && "$ns" != "default" && "$ns" != "kube-flannel" && "$ns" != "kube-node-lease" && "$ns" != "kube-public" && "$ns" != "meshery" && "$ns" != "metallb-system" && "$ns" != "projectcontour" ]];then
           echo "Deleting namespace $ns"
           kubectl delete ns "$ns"
          fi
         done

